{
  "version": "1.1.0",
  "description": "Deterministic iteration requirements per phase - enforced by hooks",

  "phase_requirements": {
    "R1-behavior-extraction": {
      "interactive_elicitation": {
        "enabled": false
      },
      "test_iteration": {
        "enabled": false
      },
      "constitutional_validation": {
        "enabled": true,
        "max_iterations": 5,
        "articles": ["I", "VII", "VIII", "IX"]
      },
      "extraction_validation": {
        "enabled": true,
        "min_confidence_percent": 80,
        "max_iterations": 10
      }
    },

    "R2-characterization-tests": {
      "interactive_elicitation": {
        "enabled": false
      },
      "test_iteration": {
        "enabled": true,
        "max_iterations": 10,
        "circuit_breaker_threshold": 3,
        "test_commands": ["npm test", "npm run test", "yarn test", "pnpm test", "pytest", "python -m pytest", "go test", "cargo test", "jest", "vitest"],
        "success_criteria": {
          "all_tests_generated": true,
          "fixtures_complete": true
        }
      },
      "constitutional_validation": {
        "enabled": true,
        "max_iterations": 5,
        "articles": ["II", "VII", "VIII", "IX", "XI"]
      }
    },

    "R3-artifact-integration": {
      "interactive_elicitation": {
        "enabled": false
      },
      "test_iteration": {
        "enabled": false
      },
      "constitutional_validation": {
        "enabled": true,
        "max_iterations": 5,
        "articles": ["VII", "IX"]
      }
    },

    "R4-atdd-bridge": {
      "interactive_elicitation": {
        "enabled": false
      },
      "test_iteration": {
        "enabled": false
      },
      "constitutional_validation": {
        "enabled": true,
        "max_iterations": 5,
        "articles": ["II", "VII", "IX"]
      },
      "atdd_validation": {
        "enabled": true,
        "when": "atdd_ready_flag",
        "requires": ["atdd_checklist_generated", "ac_tagged_as_captured_behavior"]
      }
    },

    "01-requirements": {
      "interactive_elicitation": {
        "enabled": true,
        "min_menu_interactions": 3,
        "required_final_selection": ["save", "continue"],
        "timeout_minutes": 60
      },
      "test_iteration": {
        "enabled": false
      },
      "constitutional_validation": {
        "enabled": true,
        "max_iterations": 5,
        "articles": ["I", "IV", "VII", "IX", "XII"]
      }
    },

    "02-architecture": {
      "interactive_elicitation": {
        "enabled": false
      },
      "test_iteration": {
        "enabled": false
      },
      "constitutional_validation": {
        "enabled": true,
        "max_iterations": 5,
        "articles": ["III", "IV", "V", "VII", "IX", "X"]
      }
    },

    "03-design": {
      "interactive_elicitation": {
        "enabled": false
      },
      "test_iteration": {
        "enabled": false
      },
      "constitutional_validation": {
        "enabled": true,
        "max_iterations": 5,
        "articles": ["I", "IV", "V", "VII", "IX"]
      }
    },

    "04-test-strategy": {
      "interactive_elicitation": {
        "enabled": false
      },
      "test_iteration": {
        "enabled": false
      },
      "constitutional_validation": {
        "enabled": true,
        "max_iterations": 5,
        "articles": ["II", "VII", "IX", "XI"]
      },
      "atdd_validation": {
        "enabled": true,
        "when": "atdd_mode",
        "requires": ["atdd_checklist_generated", "all_ac_have_tests", "all_tests_have_priorities"],
        "artifacts": ["docs/isdlc/atdd-checklist.json", "tests/acceptance/"],
        "gate_block_on_failure": true
      }
    },

    "05-implementation": {
      "interactive_elicitation": {
        "enabled": false
      },
      "test_iteration": {
        "enabled": true,
        "max_iterations": 10,
        "circuit_breaker_threshold": 3,
        "test_commands": ["npm test", "npm run test", "yarn test", "pnpm test", "pytest", "python -m pytest", "go test", "cargo test", "mvn test", "gradle test", "dotnet test", "jest", "mocha", "vitest"],
        "success_criteria": {
          "all_tests_passing": true,
          "min_coverage_percent": 80
        }
      },
      "constitutional_validation": {
        "enabled": true,
        "max_iterations": 5,
        "articles": ["I", "II", "III", "V", "VI", "VII", "VIII", "IX", "X"]
      },
      "atdd_validation": {
        "enabled": true,
        "when": "atdd_mode",
        "requires": ["all_priority_tests_passing", "no_orphan_skips", "red_green_transitions_recorded"],
        "priority_enforcement": {
          "process_order": ["P0", "P1", "P2", "P3"],
          "all_must_pass": true,
          "block_on_incomplete_priority": true
        },
        "gate_block_on_failure": true
      }
    },

    "06-testing": {
      "interactive_elicitation": {
        "enabled": false
      },
      "test_iteration": {
        "enabled": true,
        "max_iterations": 10,
        "circuit_breaker_threshold": 3,
        "test_commands": ["npm run test:integration", "npm run test:e2e", "npm run e2e", "cypress run", "playwright test"],
        "success_criteria": {
          "all_tests_passing": true,
          "min_coverage_percent": 70
        }
      },
      "constitutional_validation": {
        "enabled": true,
        "max_iterations": 5,
        "articles": ["II", "VII", "IX", "XI"]
      },
      "atdd_validation": {
        "enabled": true,
        "when": "atdd_mode",
        "requires": ["no_orphan_skips", "all_priorities_100_percent", "checklist_synced"],
        "orphan_skip_patterns": ["it.skip", "test.skip", "@pytest.mark.skip", "@Disabled", "@Ignore", "t.Skip", "xit", "xdescribe"],
        "scan_directories": ["tests/acceptance/", "src/test/java/acceptance/"],
        "gate_block_on_failure": true
      },
      "on_gate_pass": {
        "trigger_cloud_config": {
          "enabled": true,
          "condition": "cloud_configuration.provider === 'undecided'",
          "action": "prompt_cloud_configuration",
          "skip_option": true
        }
      }
    },

    "07-code-review": {
      "interactive_elicitation": {
        "enabled": false
      },
      "test_iteration": {
        "enabled": false
      },
      "constitutional_validation": {
        "enabled": true,
        "max_iterations": 5,
        "articles": ["V", "VI", "VII", "VIII", "IX"]
      }
    },

    "08-validation": {
      "interactive_elicitation": {
        "enabled": false
      },
      "test_iteration": {
        "enabled": false
      },
      "constitutional_validation": {
        "enabled": true,
        "max_iterations": 5,
        "articles": ["III", "IX", "X", "XII"]
      }
    },

    "09-cicd": {
      "interactive_elicitation": {
        "enabled": false
      },
      "test_iteration": {
        "enabled": true,
        "max_iterations": 5,
        "circuit_breaker_threshold": 3,
        "test_commands": ["npm run build", "npm run lint", "docker build"],
        "success_criteria": {
          "all_tests_passing": true
        }
      },
      "constitutional_validation": {
        "enabled": true,
        "max_iterations": 5,
        "articles": ["II", "IX"]
      }
    },

    "10-local-testing": {
      "interactive_elicitation": {
        "enabled": false
      },
      "test_iteration": {
        "enabled": false
      },
      "constitutional_validation": {
        "enabled": true,
        "max_iterations": 5,
        "articles": ["VIII", "IX"]
      }
    },

    "11-test-deploy": {
      "interactive_elicitation": {
        "enabled": false
      },
      "test_iteration": {
        "enabled": false
      },
      "constitutional_validation": {
        "enabled": true,
        "max_iterations": 5,
        "articles": ["IX", "X"]
      }
    },

    "12-production": {
      "interactive_elicitation": {
        "enabled": false
      },
      "test_iteration": {
        "enabled": false
      },
      "constitutional_validation": {
        "enabled": true,
        "max_iterations": 5,
        "articles": ["IX", "X"]
      }
    },

    "13-operations": {
      "interactive_elicitation": {
        "enabled": false
      },
      "test_iteration": {
        "enabled": false
      },
      "constitutional_validation": {
        "enabled": true,
        "max_iterations": 5,
        "articles": ["VIII", "IX", "XII"]
      }
    },

    "15-upgrade": {
      "interactive_elicitation": {
        "enabled": false
      },
      "test_iteration": {
        "enabled": true,
        "max_iterations": 5,
        "circuit_breaker_threshold": 3
      },
      "constitutional_validation": {
        "enabled": true,
        "max_iterations": 3,
        "articles": ["I", "VII", "IX", "X"]
      },
      "sub_phases": {
        "15-upgrade-preliminary-analysis": {
          "_comment": "Always runs - changelog fetch and quick risk assessment",
          "interactive_elicitation": {
            "enabled": false
          },
          "test_iteration": {
            "enabled": false
          },
          "constitutional_validation": {
            "enabled": false
          }
        },
        "15-upgrade-impact-analysis": {
          "_comment": "Conditional - runs when user chooses comprehensive analysis",
          "trigger": "user_choice",
          "trigger_options": ["quick", "comprehensive", "skip"],
          "when_comprehensive": {
            "delegates_to": "impact-analysis-orchestrator",
            "workflow_context": "upgrade",
            "sub_agents": ["M1-impact-analyzer", "M2-entry-point-finder", "M3-risk-assessor"],
            "timeout_minutes": 10
          },
          "interactive_elicitation": {
            "enabled": true,
            "min_menu_interactions": 1,
            "required_final_selection": ["quick", "comprehensive", "skip"],
            "timeout_minutes": 5
          },
          "test_iteration": {
            "enabled": false
          },
          "constitutional_validation": {
            "enabled": false
          }
        }
      }
    }
  },

  "gate_blocking_rules": {
    "block_on_incomplete_test_iteration": true,
    "block_on_incomplete_constitutional": true,
    "block_on_incomplete_elicitation": true,
    "allow_escalation_override": true
  },

  "escalation_rules": {
    "test_iteration_max_exceeded": "human_review",
    "constitutional_max_exceeded": "human_decision",
    "circuit_breaker_triggered": "human_review",
    "timeout_exceeded": "human_notification"
  },

  "workflow_overrides": {
    "_comment": "Per-workflow overrides that merge with base phase_requirements when a workflow is active",

    "reverse-engineer": {
      "R1-behavior-extraction": {
        "extraction_validation": {
          "min_confidence_percent": 70,
          "_comment": "Allow lower confidence threshold when --priority critical is used"
        }
      },
      "R2-characterization-tests": {
        "test_iteration": {
          "max_iterations": 15,
          "_comment": "Allow more iterations for complex test generation"
        }
      }
    },

    "fix": {
      "01-requirements": {
        "interactive_elicitation": {
          "min_menu_interactions": 1,
          "scope": "bug-report"
        }
      },
      "05-implementation": {
        "test_iteration": {
          "require_failing_test_first": true
        }
      }
    },

    "test-run": {
      "06-testing": {
        "constitutional_validation": {
          "enabled": false
        },
        "test_iteration": {
          "max_iterations": 1,
          "report_only": true
        }
      }
    },

    "test-generate": {
      "04-test-strategy": {
        "constitutional_validation": {
          "enabled": false
        }
      },
      "06-testing": {
        "test_iteration": {
          "max_iterations": 5
        }
      }
    }
  }
}
