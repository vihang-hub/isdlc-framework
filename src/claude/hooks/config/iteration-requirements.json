{
  "version": "1.0.0",
  "description": "Deterministic iteration requirements per phase - enforced by hooks",

  "phase_requirements": {
    "01-requirements": {
      "interactive_elicitation": {
        "enabled": true,
        "min_menu_interactions": 3,
        "required_final_selection": ["save", "continue"],
        "timeout_minutes": 60
      },
      "test_iteration": {
        "enabled": false
      },
      "constitutional_validation": {
        "enabled": true,
        "max_iterations": 5,
        "articles": ["I", "IV", "VII", "IX", "XII"]
      }
    },

    "02-architecture": {
      "interactive_elicitation": {
        "enabled": false
      },
      "test_iteration": {
        "enabled": false
      },
      "constitutional_validation": {
        "enabled": true,
        "max_iterations": 5,
        "articles": ["III", "IV", "V", "VII", "IX", "X"]
      }
    },

    "03-design": {
      "interactive_elicitation": {
        "enabled": false
      },
      "test_iteration": {
        "enabled": false
      },
      "constitutional_validation": {
        "enabled": true,
        "max_iterations": 5,
        "articles": ["I", "IV", "V", "VII", "IX"]
      }
    },

    "04-test-strategy": {
      "interactive_elicitation": {
        "enabled": false
      },
      "test_iteration": {
        "enabled": false
      },
      "constitutional_validation": {
        "enabled": true,
        "max_iterations": 5,
        "articles": ["II", "VII", "IX", "XI"]
      },
      "atdd_validation": {
        "enabled": true,
        "when": "atdd_mode",
        "requires": ["atdd_checklist_generated", "all_ac_have_tests", "all_tests_have_priorities"],
        "artifacts": [".isdlc/atdd-checklist.json", "tests/acceptance/"],
        "gate_block_on_failure": true
      }
    },

    "05-implementation": {
      "interactive_elicitation": {
        "enabled": false
      },
      "test_iteration": {
        "enabled": true,
        "max_iterations": 10,
        "circuit_breaker_threshold": 3,
        "test_commands": ["npm test", "npm run test", "yarn test", "pnpm test", "pytest", "python -m pytest", "go test", "cargo test", "mvn test", "gradle test", "dotnet test", "jest", "mocha", "vitest"],
        "success_criteria": {
          "all_tests_passing": true,
          "min_coverage_percent": 80
        }
      },
      "constitutional_validation": {
        "enabled": true,
        "max_iterations": 5,
        "articles": ["I", "II", "III", "V", "VI", "VII", "VIII", "IX", "X"]
      },
      "atdd_validation": {
        "enabled": true,
        "when": "atdd_mode",
        "requires": ["all_priority_tests_passing", "no_orphan_skips", "red_green_transitions_recorded"],
        "priority_enforcement": {
          "process_order": ["P0", "P1", "P2", "P3"],
          "all_must_pass": true,
          "block_on_incomplete_priority": true
        },
        "gate_block_on_failure": true
      }
    },

    "06-testing": {
      "interactive_elicitation": {
        "enabled": false
      },
      "test_iteration": {
        "enabled": true,
        "max_iterations": 10,
        "circuit_breaker_threshold": 3,
        "test_commands": ["npm run test:integration", "npm run test:e2e", "npm run e2e", "cypress run", "playwright test"],
        "success_criteria": {
          "all_tests_passing": true,
          "min_coverage_percent": 70
        }
      },
      "constitutional_validation": {
        "enabled": true,
        "max_iterations": 5,
        "articles": ["II", "VII", "IX", "XI"]
      },
      "atdd_validation": {
        "enabled": true,
        "when": "atdd_mode",
        "requires": ["no_orphan_skips", "all_priorities_100_percent", "checklist_synced"],
        "orphan_skip_patterns": ["it.skip", "test.skip", "@pytest.mark.skip", "@Disabled", "@Ignore", "t.Skip", "xit", "xdescribe"],
        "scan_directories": ["tests/acceptance/", "src/test/java/acceptance/"],
        "gate_block_on_failure": true
      },
      "on_gate_pass": {
        "trigger_cloud_config": {
          "enabled": true,
          "condition": "cloud_configuration.provider === 'undecided'",
          "action": "prompt_cloud_configuration",
          "skip_option": true
        }
      }
    },

    "07-code-review": {
      "interactive_elicitation": {
        "enabled": false
      },
      "test_iteration": {
        "enabled": false
      },
      "constitutional_validation": {
        "enabled": true,
        "max_iterations": 5,
        "articles": ["V", "VI", "VII", "VIII", "IX"]
      }
    },

    "08-validation": {
      "interactive_elicitation": {
        "enabled": false
      },
      "test_iteration": {
        "enabled": false
      },
      "constitutional_validation": {
        "enabled": true,
        "max_iterations": 5,
        "articles": ["III", "IX", "X", "XII"]
      }
    },

    "09-cicd": {
      "interactive_elicitation": {
        "enabled": false
      },
      "test_iteration": {
        "enabled": true,
        "max_iterations": 5,
        "circuit_breaker_threshold": 3,
        "test_commands": ["npm run build", "npm run lint", "docker build"],
        "success_criteria": {
          "all_tests_passing": true
        }
      },
      "constitutional_validation": {
        "enabled": true,
        "max_iterations": 5,
        "articles": ["II", "IX"]
      }
    },

    "10-local-testing": {
      "interactive_elicitation": {
        "enabled": false
      },
      "test_iteration": {
        "enabled": false
      },
      "constitutional_validation": {
        "enabled": true,
        "max_iterations": 5,
        "articles": ["VIII", "IX"]
      }
    },

    "11-test-deploy": {
      "interactive_elicitation": {
        "enabled": false
      },
      "test_iteration": {
        "enabled": false
      },
      "constitutional_validation": {
        "enabled": true,
        "max_iterations": 5,
        "articles": ["IX", "X"]
      }
    },

    "12-production": {
      "interactive_elicitation": {
        "enabled": false
      },
      "test_iteration": {
        "enabled": false
      },
      "constitutional_validation": {
        "enabled": true,
        "max_iterations": 5,
        "articles": ["IX", "X"]
      }
    },

    "13-operations": {
      "interactive_elicitation": {
        "enabled": false
      },
      "test_iteration": {
        "enabled": false
      },
      "constitutional_validation": {
        "enabled": true,
        "max_iterations": 5,
        "articles": ["VIII", "IX", "XII"]
      }
    }
  },

  "gate_blocking_rules": {
    "block_on_incomplete_test_iteration": true,
    "block_on_incomplete_constitutional": true,
    "block_on_incomplete_elicitation": true,
    "allow_escalation_override": true
  },

  "escalation_rules": {
    "test_iteration_max_exceeded": "human_review",
    "constitutional_max_exceeded": "human_decision",
    "circuit_breaker_triggered": "human_review",
    "timeout_exceeded": "human_notification"
  },

  "workflow_overrides": {
    "_comment": "Per-workflow overrides that merge with base phase_requirements when a workflow is active",

    "fix": {
      "01-requirements": {
        "interactive_elicitation": {
          "min_menu_interactions": 1,
          "scope": "bug-report"
        }
      },
      "05-implementation": {
        "test_iteration": {
          "require_failing_test_first": true
        }
      }
    },

    "test-run": {
      "06-testing": {
        "constitutional_validation": {
          "enabled": false
        },
        "test_iteration": {
          "max_iterations": 1,
          "report_only": true
        }
      }
    },

    "test-generate": {
      "04-test-strategy": {
        "constitutional_validation": {
          "enabled": false
        }
      },
      "06-testing": {
        "test_iteration": {
          "max_iterations": 5
        }
      }
    }
  }
}
