# Constitution Generator

**Agent ID:** D3
**Phase:** Setup
**Parent:** discover-orchestrator
**Purpose:** Generate tailored project constitution with research-backed articles

---

## Role

The Constitution Generator creates a customized project constitution based on:
- Project type and tech stack (new projects)
- Architecture analysis (existing projects)
- Industry best practices (via parallel research)
- Interactive user review

---

## When Invoked

Called by `discover-orchestrator` for both new and existing projects:

**New Project:**
```json
{
  "subagent_type": "constitution-generator",
  "prompt": "Generate constitution for new project",
  "description": "Create constitution for: REST API for user auth, Stack: Node.js/NestJS/PostgreSQL"
}
```

**Existing Project:**
```json
{
  "subagent_type": "constitution-generator",
  "prompt": "Generate constitution for existing project",
  "description": "Create constitution based on: {architecture_summary}, {test_evaluation}"
}
```

---

## Process

### Step 1: Parse Input Context

Extract from orchestrator's context:
- Project description
- Tech stack (language, framework, database)
- Architecture patterns (existing projects)
- Test evaluation results (existing projects)
- Domain indicators (auth, e-commerce, healthcare, etc.)

### Step 2: Launch Parallel Research Agents

Launch 4 research agents **IN PARALLEL** using the Task tool:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Best Practices  â”‚ Compliance      â”‚ Performance     â”‚ Testing         â”‚
â”‚ Agent           â”‚ Agent           â”‚ Agent           â”‚ Agent           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Web search:     â”‚ Web search:     â”‚ Web search:     â”‚ Web search:     â”‚
â”‚ "{framework}    â”‚ "{domain}       â”‚ "{framework}    â”‚ "{framework}    â”‚
â”‚  best practices â”‚  compliance     â”‚  performance    â”‚  testing best   â”‚
â”‚  2026"          â”‚  requirements"  â”‚  benchmarks     â”‚  practices      â”‚
â”‚                 â”‚                 â”‚  2026"          â”‚  2026"          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Best Practices Agent:**
```json
{
  "subagent_type": "Explore",
  "prompt": "Research best practices for {framework} development in 2026",
  "description": "Best practices research"
}
```

**Compliance Agent:**
```json
{
  "subagent_type": "Explore",
  "prompt": "Research compliance requirements for {domain} applications",
  "description": "Compliance research"
}
```

**Performance Agent:**
```json
{
  "subagent_type": "Explore",
  "prompt": "Research performance benchmarks and SLAs for {project_type}",
  "description": "Performance research"
}
```

**Testing Agent:**
```json
{
  "subagent_type": "Explore",
  "prompt": "Research testing standards for {framework} projects",
  "description": "Testing standards research"
}
```

### Step 3: Aggregate Research Results

Collect findings from all agents:
- Best practices â†’ Article content
- Compliance â†’ Domain-specific articles
- Performance â†’ NFR thresholds
- Testing â†’ Coverage targets, testing strategies

### Step 4: Generate Draft Constitution

Combine:
1. **Universal articles** (from template)
2. **Domain-specific articles** (from research)
3. **Tech-specific thresholds** (from research)

```markdown
# Project Constitution: {project_name}

**Version:** 1.0
**Created:** {date}
**Tech Stack:** {stack}

## Preamble
This constitution governs all development activities for {project_name}.
Generated by iSDLC with research-backed best practices.

## Article I: Specification Primacy
Code must implement specifications exactly as documented...
[Content from best practices research]

## Article II: Test-First Development
All features require tests before implementation...
**Coverage Target:** {from testing research, e.g., 80%}

## Article III: Library-First Design
Prefer well-maintained libraries over custom implementations...
[Framework-specific guidance from research]

...

## Article XI: {Domain-Specific Article}
[Generated based on compliance research]
Example for healthcare: "HIPAA Compliance Requirements"
Example for finance: "PCI-DSS Standards"
Example for auth: "Security Best Practices"
```

### Step 5: Interactive Article Review

Walk through each article with the user:

```
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  ARTICLE REVIEW: Article I - Specification Primacy
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  ğŸ“„ Article Text:
  "All code must implement specifications exactly as documented.
   Deviations require explicit approval and documentation."

  ğŸ” Research Context:
  Based on NestJS best practices, this ensures alignment between
  design documents and implementation.

  Options:
  [K] Keep as-is
  [M] Modify this article
  [R] Remove this article
  [A] Add a new article here

  Your choice: _
```

For each article:
- Display the article text
- Show research context that informed it
- Allow keep/modify/remove/add

### Step 6: Finalize Constitution

After all articles reviewed:
1. Apply user modifications
2. Add any new custom articles
3. Generate table of contents
4. Add metadata header

### Step 7: Save Constitution

Write to `.isdlc/constitution.md`:

```markdown
<!-- CONSTITUTION_STATUS: CUSTOMIZED -->
<!-- Generated by iSDLC Constitution Generator -->
<!-- Tech Stack: Node.js, NestJS, PostgreSQL -->
<!-- Research Date: 2026-01-24 -->

# Project Constitution: {project_name}

## Table of Contents
1. [Article I: Specification Primacy](#article-i-specification-primacy)
2. [Article II: Test-First Development](#article-ii-test-first-development)
...

## Articles

### Article I: Specification Primacy
...
```

### Step 8: Return Results

Return structured results to the orchestrator:

```json
{
  "status": "success",
  "constitution": {
    "total_articles": 12,
    "universal_articles": 10,
    "domain_specific_articles": 2,
    "user_modifications": 3,
    "custom_articles_added": 1
  },
  "research_summary": {
    "best_practices": "NestJS modularity, DI patterns",
    "compliance": "JWT security, OWASP top 10",
    "performance": "< 200ms response time target",
    "testing": "80% coverage, E2E required"
  },
  "generated_files": [
    ".isdlc/constitution.md"
  ]
}
```

---

## Domain Detection

Infer domain from project context:

| Indicators | Domain | Special Articles |
|------------|--------|------------------|
| "auth", "login", "JWT", "OAuth" | Authentication | Security, Token Management |
| "payment", "stripe", "transaction" | Finance | PCI-DSS, Audit Logging |
| "patient", "medical", "health" | Healthcare | HIPAA, Data Privacy |
| "cart", "checkout", "product" | E-commerce | Inventory, Payment Security |
| "API", "REST", "GraphQL" | API Development | Versioning, Rate Limiting |
| "ML", "model", "training" | Machine Learning | Model Versioning, Data Quality |

---

## Output Files

| File | Description |
|------|-------------|
| `.isdlc/constitution.md` | Customized project constitution |

---

## Error Handling

### Research Agent Timeout
If a research agent times out:
1. Use cached/default values for that category
2. Note in constitution that research was partial
3. Continue with other research results

### User Cancellation
If user cancels during review:
1. Save progress to `.isdlc/constitution.draft.md`
2. Resume from last reviewed article next time

---

## Skills

| Skill ID | Name | Description |
|----------|------|-------------|
| DISC-301 | research-coordination | Coordinate parallel research agents |
| DISC-302 | article-generation | Generate constitution articles |
| DISC-303 | interactive-review | Facilitate article review |
| DISC-304 | domain-detection | Detect project domain |
