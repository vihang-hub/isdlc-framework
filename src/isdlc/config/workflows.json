{
  "version": "1.0.0",
  "description": "Workflow definitions for iSDLC - each workflow defines a fixed, non-skippable phase sequence",
  "workflows": {
    "feature": {
      "label": "New Feature",
      "command": "/isdlc feature",
      "description": "Implement a new feature end-to-end",
      "phases": [
        "00-quick-scan",
        "01-requirements",
        "02-impact-analysis",
        "03-architecture",
        "04-design",
        "05-test-strategy",
        "06-implementation",
        "16-quality-loop",
        "08-code-review"
      ],
      "gate_mode": "strict",
      "options": {
        "atdd_mode": {
          "description": "Enable ATDD with test.skip() scaffolds and Given-When-Then AC mapping",
          "default": false,
          "flag": "--atdd"
        },
        "skip_exploration": {
          "description": "Skip Phase 00 Quick Scan for simple features",
          "default": false,
          "flag": "--no-scan"
        },
        "light": {
          "description": "Force lightweight workflow (skip architecture and design phases)",
          "default": false,
          "flag": "-light"
        },
        "supervised": {
          "description": "Enable supervised mode with review gates between phases",
          "default": false,
          "flag": "--supervised"
        }
      },
      "sizing": {
        "enabled": true,
        "thresholds": {
          "light_max_files": 5,
          "epic_min_files": 20
        },
        "light_skip_phases": ["03-architecture", "04-design"],
        "risk_override": {
          "high_risk_forces_standard_minimum": true
        }
      },
      "agent_modifiers": {
        "00-quick-scan": {
          "scope": "lightweight-scan",
          "generate_scope_estimate": true,
          "output": [
            "estimated_scope",
            "keyword_matches",
            "file_count_estimate"
          ]
        },
        "01-requirements": {
          "scope": "feature",
          "artifact_prefix": "REQ",
          "read_quick_scan": true
        },
        "02-impact-analysis": {
          "scope": "full-impact-analysis",
          "run_parallel_subagents": true,
          "generate_impact_analysis": true,
          "read_requirements": true
        },
        "03-architecture": {
          "scope": "impact-assessment"
        },
        "05-test-strategy": {
          "_when_atdd_mode": {
            "generate_skipped_tests": true,
            "require_given_when_then_ac": true,
            "create_atdd_checklist": true
          }
        },
        "06-implementation": {
          "_when_atdd_mode": {
            "track_red_green_transitions": true,
            "require_priority_order": true,
            "all_priorities_must_pass": true
          }
        },
        "16-quality-loop": {
          "scope": "parallel-quality-check"
        },
        "08-code-review": {
          "scope": "human-review-only"
        }
      },
      "requires_branch": true
    },
    "fix": {
      "label": "Bug Fix",
      "command": "/isdlc fix",
      "description": "Fix a bug or defect with TDD",
      "phases": [
        "01-requirements",
        "02-tracing",
        "05-test-strategy",
        "06-implementation",
        "16-quality-loop",
        "08-code-review"
      ],
      "gate_mode": "strict",
      "options": {
        "atdd_mode": {
          "description": "Enable ATDD with test.skip() scaffolds and Given-When-Then AC mapping",
          "default": false,
          "flag": "--atdd"
        },
        "skip_exploration": {
          "description": "Skip Phase 02 Tracing for simple bugs",
          "default": false,
          "flag": "--no-tracing"
        },
        "supervised": {
          "description": "Enable supervised mode with review gates between phases",
          "default": false,
          "flag": "--supervised"
        }
      },
      "agent_modifiers": {
        "01-requirements": {
          "scope": "bug-report",
          "artifact_prefix": "BUG",
          "require_external_id": true
        },
        "02-tracing": {
          "scope": "bug-exploration",
          "run_parallel_subagents": true,
          "generate_trace_analysis": true,
          "read_bug_report": true
        },
        "05-test-strategy": {
          "_when_atdd_mode": {
            "generate_skipped_tests": true,
            "require_given_when_then_ac": true,
            "create_atdd_checklist": true
          }
        },
        "06-implementation": {
          "require_failing_test_first": true,
          "_when_atdd_mode": {
            "track_red_green_transitions": true,
            "require_priority_order": true,
            "all_priorities_must_pass": true
          }
        },
        "16-quality-loop": {
          "scope": "parallel-quality-check"
        },
        "08-code-review": {
          "scope": "human-review-only"
        }
      },
      "requires_branch": true
    },
    "test-run": {
      "label": "Run Tests",
      "command": "/isdlc test run",
      "description": "Execute existing automation tests",
      "phases": [
        "11-local-testing",
        "07-testing"
      ],
      "gate_mode": "strict",
      "agent_modifiers": {
        "11-local-testing": {
          "scope": "local"
        }
      },
      "options": {
        "test_type": {
          "prompt": "Which tests do you want to run?",
          "choices": [
            "unit",
            "system",
            "e2e"
          ],
          "multi_select": true
        }
      },
      "requires_branch": false
    },
    "test-generate": {
      "label": "Generate Tests",
      "command": "/isdlc test generate",
      "description": "Create new tests for existing code",
      "phases": [
        "05-test-strategy",
        "06-implementation",
        "11-local-testing",
        "07-testing",
        "08-code-review"
      ],
      "gate_mode": "strict",
      "agent_modifiers": {
        "11-local-testing": {
          "scope": "local"
        }
      },
      "options": {
        "test_type": {
          "prompt": "What type of tests do you want to generate?",
          "choices": [
            "unit",
            "system",
            "e2e"
          ],
          "multi_select": false
        }
      },
      "requires_branch": false
    },
    "upgrade": {
      "label": "Dependency/Tool Upgrade",
      "command": "/isdlc upgrade <name>",
      "description": "Upgrade a dependency, runtime, framework, or tool with full impact analysis and regression testing",
      "phases": [
        "15-upgrade-plan",
        "15-upgrade-execute",
        "08-code-review"
      ],
      "gate_mode": "strict",
      "options": {
        "name": {
          "type": "string",
          "required": true,
          "prompt": "What dependency, runtime, or tool do you want to upgrade?"
        },
        "max_iterations": {
          "type": "integer",
          "default": 10,
          "description": "Maximum implement-test loop iterations"
        }
      },
      "agent_modifiers": {
        "15-upgrade-plan": {
          "scope": "analysis",
          "require_user_approval": true
        },
        "15-upgrade-execute": {
          "scope": "execution",
          "max_iterations": 10
        },
        "08-code-review": {
          "scope": "upgrade-review"
        }
      },
      "requires_branch": true
    },
    "reverse-engineer": {
      "label": "Reverse Engineer",
      "command": "/isdlc reverse-engineer",
      "description": "Extract acceptance criteria and generate characterization tests from existing code",
      "phases": [
        "R1-behavior-extraction",
        "R2-characterization-tests",
        "R3-artifact-integration",
        "R4-atdd-bridge"
      ],
      "gate_mode": "permissive",
      "options": {
        "scope": {
          "prompt": "What scope do you want to analyze?",
          "choices": [
            "all",
            "module",
            "endpoint",
            "domain"
          ],
          "default": "all"
        },
        "target": {
          "prompt": "Specify target name (module, endpoint path, or domain name)",
          "type": "string",
          "required_when": [
            "scope:module",
            "scope:endpoint",
            "scope:domain"
          ]
        },
        "priority": {
          "prompt": "Filter by risk priority",
          "choices": [
            "all",
            "critical",
            "high",
            "medium"
          ],
          "default": "all"
        },
        "generate_tests": {
          "description": "Generate characterization tests",
          "flag": "--generate-tests",
          "default": true
        },
        "atdd_ready": {
          "description": "Prepare artifacts for ATDD workflow integration",
          "flag": "--atdd-ready",
          "default": false
        }
      },
      "prerequisites": {
        "discover_completed": true,
        "artifacts_required": [
          "docs/project-discovery-report.md",
          ".isdlc/test-evaluation-report.md"
        ]
      },
      "agent_modifiers": {
        "R1-behavior-extraction": {
          "read_discovery_artifacts": true,
          "prioritize_by_risk": true
        },
        "R2-characterization-tests": {
          "use_test_skip_scaffolds": true,
          "capture_side_effects": true
        },
        "R3-artifact-integration": {
          "link_to_feature_map": true,
          "generate_traceability": true
        },
        "R4-atdd-bridge": {
          "_when_atdd_ready": {
            "create_atdd_checklist": true,
            "mark_as_captured_behavior": true,
            "set_pending_human_review": true
          }
        }
      },
      "requires_branch": false
    }
  },
  "rules": {
    "no_halfway_entry": true,
    "no_agent_phase_skipping": true,
    "_comment_phase_skipping": "Agents cannot skip phases at runtime. Framework-level sizing modifications to the phase array (REQ-0011) are permitted before phases are encountered.",
    "single_active_workflow_per_project": true,
    "require_cancellation_reason": true
  }
}
