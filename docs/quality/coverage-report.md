# Coverage Report: BUG-0012-premature-git-commit

**Phase**: 16-quality-loop
**Date**: 2026-02-13

---

## Coverage Tool

Node.js built-in `--experimental-test-coverage` used for branch-guard.cjs analysis.

## Instrumented Coverage: branch-guard.cjs

| Metric | Value | Notes |
|--------|-------|-------|
| Line coverage | **98.43%** | Lines 186-188 uncovered (top-level catch block, unreachable in normal flow) |
| Function coverage | **100%** | All 3 functions exercised: main(), isGitCommit(), getCurrentBranch() |
| Branch coverage | **44.44%** | Low number reflects Node coverage counting common.cjs shared library branches |

### Uncovered Lines

| Lines | Code | Reason |
|-------|------|--------|
| 186-188 | `catch (error) { debugLog(...); process.exit(0); }` | Top-level error handler; only reached on unexpected runtime errors; exercised indirectly by fail-open tests |

## Test Coverage by Suite

| Suite | Tests | Pass | Fail | Coverage |
|-------|-------|------|------|----------|
| Branch-guard (`node --test branch-guard.test.cjs`) | 31 | 31 | 0 | 98.43% line, 100% function |
| CJS hooks (`npm run test:hooks`) | 1129 | 1129 | 0 | All hook modules exercised |
| ESM lib (`npm test`) | 490 | 489 | 1 | TC-E09 pre-existing |
| **Total** | **1650** | **1649** | **1** | |

## Acceptance Criteria Coverage (Manual Analysis)

### BUG-0012: Phase-Aware Commit Blocking -- 17 new tests

#### Hook Logic Tests (T15-T26)

| Category | Test IDs | Count | Status |
|----------|----------|-------|--------|
| Block during intermediate phases | T15 (implementation), T16 (quality-loop), T17 (test-strategy) | 3 | COVERED |
| Allow during final phase | T18 (code-review), T25 (non-standard last phase) | 2 | COVERED |
| Fail-open: no active_workflow | T19 | 1 | COVERED |
| Allow: non-workflow branch | T20 | 1 | COVERED |
| Fail-open: missing current_phase | T21 | 1 | COVERED |
| Fail-open: missing phases array | T22 | 1 | COVERED |
| Allow: git add without commit | T23 | 1 | COVERED |
| Block message content validation | T24 | 1 | COVERED |
| Regression: main protection intact | T26 | 1 | COVERED |

#### Agent Instruction Tests (T27-T31)

| Category | Test IDs | Count | Status |
|----------|----------|-------|--------|
| software-developer no-commit instruction present | T27 | 1 | COVERED |
| software-developer explains WHY | T28 | 1 | COVERED |
| software-developer mentions orchestrator | T29 | 1 | COVERED |
| quality-loop-engineer no-commit instruction | T30 | 1 | COVERED |
| quality-loop-engineer explains code review not run | T31 | 1 | COVERED |

### AC-to-Test Traceability

| AC | Description | Test Case(s) |
|----|-------------|-------------|
| AC-01 | software-developer has "Do NOT" git commit | T27 |
| AC-02 | Instruction within first 80 lines | T27 |
| AC-03 | Explains quality-loop and code-review | T28 |
| AC-04 | Mentions orchestrator | T29 |
| AC-05 | quality-loop-engineer has no-commit instruction | T30 |
| AC-06 | quality-loop-engineer explains code review not run | T31 |
| AC-07 | Block during 06-implementation | T15 |
| AC-08 | Allow during final phase | T18, T25 |
| AC-09 | Block during 16-quality-loop | T16 |
| AC-10 | Allow during 08-code-review (final) | T18 |
| AC-11 | Fail-open: no active_workflow | T19 |
| AC-12 | Allow on non-workflow branch | T20 |
| AC-13 | Block message includes phase name | T24 |
| AC-14 | Fail-open: missing current_phase or phases | T21, T22 |
| AC-15 | Final phase = last element of phases array | T18, T25 |
| AC-16 | Works with variable-length workflows | T25 |
| AC-17 | Existing main protection intact | T26 |
| AC-18 | git add without commit allowed | T23 |
| AC-19 | Block message suggests git stash | T24 |
| AC-20 | Block message mentions orchestrator | T24 |

### Coverage Summary

| Metric | Value |
|--------|-------|
| Total new tests (BUG-0012) | 17 |
| Pre-existing branch-guard tests | 14 |
| Total branch-guard tests | **31** |
| Total CJS tests | **1129** |
| CJS test pass rate | **100%** (1129/1129) |
| ESM test pass rate | **99.8%** (489/490, 1 pre-existing) |
| Acceptance criteria covered | **20/20 (100%)** |

---

**Generated by**: Quality Loop Engineer (Phase 16)
**Timestamp**: 2026-02-13
